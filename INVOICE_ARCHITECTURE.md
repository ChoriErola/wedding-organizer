# ğŸ¯ Invoice Pelanggan - Architecture & Flow Diagram

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CUSTOMER INVOICE SYSTEM                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                          ROUTES LAYER
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  GET /pelanggan/pesanan/{order}/invoice  â”‚
        â”‚  Name: pelanggan.pesanan.invoice         â”‚
        â”‚  Middleware: auth                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Livewire Component      â”‚
              â”‚  InvoiceShow             â”‚
              â”‚                          â”‚
              â”‚  - mount()               â”‚
              â”‚  - downloadPdf()         â”‚
              â”‚  - viewPdf()             â”‚
              â”‚  - render()              â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                            â”‚
              â–¼                            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ORDER SERVICE   â”‚        â”‚ BLADE TEMPLATE â”‚
        â”‚ OrderInvoice    â”‚        â”‚ invoice-show   â”‚
        â”‚ Service         â”‚        â”‚                â”‚
        â”‚                 â”‚        â”‚ - Display data â”‚
        â”‚ - generate()    â”‚        â”‚ - UI Layout    â”‚
        â”‚ - PDF via       â”‚        â”‚ - Buttons      â”‚
        â”‚   DomPDF        â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  PDF File      â”‚
          â”‚  (DomPDF)      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## User Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Customer   â”‚
â”‚    Login     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard / Pesanan List Page       â”‚
â”‚  GET /pelanggan/pesanan              â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€ Card Pesanan 1                   â”‚
â”‚  â”‚ â”œâ”€ Paket: Wedding Gold             â”‚
â”‚  â”‚ â”œâ”€ Total: Rp 50.000.000            â”‚
â”‚  â”‚ â””â”€ [Lihat Invoice Button]  â—„â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                 â”‚  â”‚
â”‚  â”œâ”€ Card Pesanan 2                  â”‚  â”‚
â”‚  â”‚ â””â”€ [Lihat Invoice Button]  â—„â”€â”€â”€â”€â”¼â”€â”¤
â”‚  â””â”€ ...                             â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                          â”‚
                    Click "Lihat Invoice"  â”‚
                                          â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ InvoiceShow Component          â”‚
                     â”‚ GET /pelanggan/pesanan/{id}    â”‚
                     â”‚ /invoice                       â”‚
                     â”‚                                â”‚
                     â”‚ Authentication âœ“               â”‚
                     â”‚ Authorization âœ“                â”‚
                     â”‚ Load Order Data                â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  Invoice Display Page      â”‚
                     â”‚                            â”‚
                     â”‚  â”Œâ”€ Invoice Header        â”‚
                     â”‚  â”‚ â”Œâ”€ Order Code          â”‚
                     â”‚  â”‚ â”œâ”€ Invoice Date        â”‚
                     â”‚  â”‚ â””â”€ Event Date          â”‚
                     â”‚  â”‚                        â”‚
                     â”‚  â”œâ”€ Customer Info        â”‚
                     â”‚  â”‚                        â”‚
                     â”‚  â”œâ”€ Order Details        â”‚
                     â”‚  â”‚                        â”‚
                     â”‚  â”œâ”€ Services Table       â”‚
                     â”‚  â”‚ â”œâ”€ Package (base)     â”‚
                     â”‚  â”‚ â””â”€ Additional Servicesâ”‚
                     â”‚  â”‚                        â”‚
                     â”‚  â”œâ”€ Payment Status       â”‚
                     â”‚  â”‚                        â”‚
                     â”‚  â”œâ”€ Order Notes          â”‚
                     â”‚  â”‚                        â”‚
                     â”‚  â””â”€ Action Buttons       â”‚
                     â”‚    â”œâ”€ [ğŸ‘ï¸ Lihat]        â”‚
                     â”‚    â”œâ”€ [â¬‡ï¸ Unduh]        â”‚
                     â”‚    â””â”€ [â† Kembali]       â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                           â”‚
                    â–¼                           â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  View PDF       â”‚        â”‚  Download PDF    â”‚
           â”‚  (Inline)       â”‚        â”‚  (File)          â”‚
           â”‚                 â”‚        â”‚                  â”‚
           â”‚ Display in      â”‚        â”‚ Save to Downloadsâ”‚
           â”‚ Browser         â”‚        â”‚ Filename: invoiceâ”‚
           â”‚                 â”‚        â”‚ -{order_code}.pdfâ”‚
           â”‚ Can Print âœ“     â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼ / Click Back
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Return to Orders List      â”‚
           â”‚  /pelanggan/pesanan         â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Structure

```
App\Livewire\Pelanggan\InvoiceShow
â”œâ”€ Properties
â”‚  â””â”€ Order $order
â”‚
â”œâ”€ Methods
â”‚  â”œâ”€ mount(Order $order)
â”‚  â”‚  â””â”€ Validates user ownership
â”‚  â”‚     â””â”€ Aborts if unauthorized
â”‚  â”‚
â”‚  â”œâ”€ downloadPdf()
â”‚  â”‚  â””â”€ Calls OrderInvoiceService::generate()
â”‚  â”‚     â””â”€ Returns PDF response (attachment)
â”‚  â”‚
â”‚  â”œâ”€ viewPdf()
â”‚  â”‚  â””â”€ Calls OrderInvoiceService::generate()
â”‚  â”‚     â””â”€ Returns PDF response (inline)
â”‚  â”‚
â”‚  â””â”€ render()
â”‚     â””â”€ Returns view('livewire.pelanggan.invoice-show')
â”‚
â””â”€ Blade Template
   â””â”€ resources/views/livewire/pelanggan/invoice-show.blade.php
      â”œâ”€ Header Section
      â”œâ”€ Action Buttons
      â”œâ”€ Customer Information
      â”œâ”€ Order Details
      â”œâ”€ Items/Services Table
      â”œâ”€ Payment Status
      â”œâ”€ Order Notes
      â””â”€ Service Notes
```

## Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Order Model â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Relationships:
       â”œâ”€ Customer (JSON)
       â”œâ”€ Package
       â”œâ”€ Services (OrderService)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ InvoiceShow          â”‚
â”‚ Component            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Process:
       â”‚ 1. Load order with relationships
       â”‚ 2. Validate user ownership
       â”‚ 3. Pass to blade template
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ invoice-show.blade.php    â”‚
â”‚ Template                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Compute:
       â”‚ 1. Package service IDs
       â”‚ 2. Additional services (NOT in package)
       â”‚ 3. Format prices/dates
       â”‚ 4. Build HTML
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OrderInvoiceService      â”‚
â”‚ (when PDF action clicked)â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Process:
       â”‚ 1. Clean data (ASCII)
       â”‚ 2. Setup Seller/Buyer
       â”‚ 3. Build items array
       â”‚ 4. Parse payment notes
       â”‚ 5. Render template
       â”‚ 6. PDF via DomPDF
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PDF Output  â”‚
â”‚ (Download)  â”‚
â”‚ (View)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Flow

```
Request: GET /pelanggan/pesanan/{order}/invoice

Step 1: Middleware Auth Check
  â”œâ”€ Is user authenticated?
  â”‚  â”œâ”€ YES â†’ Continue
  â”‚  â””â”€ NO â†’ Redirect to /login
  â”‚
Step 2: Livewire Route Resolution
  â”œâ”€ Load Order model
  â””â”€ Pass to InvoiceShow component
      â”‚
Step 3: Component Mount
  â”œâ”€ Check: Auth::id() == $order->user_id
  â”‚  â”œâ”€ EQUAL â†’ Allow
  â”‚  â””â”€ NOT EQUAL â†’ abort(403, 'Unauthorized')
  â”‚
Step 4: Render View
  â”œâ”€ Access order data
  â””â”€ Display invoice
```

## Database Relations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Orders   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id         â”‚
â”‚ user_id    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ package_id â”‚â—„â”€â”€â”           â”‚
â”‚ order_code â”‚   â”‚           â”‚
â”‚ event_date â”‚   â”‚           â”‚
â”‚ base_price â”‚   â”‚           â”‚
â”‚ total_priceâ”‚   â”‚           â”‚
â”‚ status     â”‚   â”‚           â”‚
â”‚ customer[] â”‚   â”‚           â”‚
â”‚ alamat     â”‚   â”‚           â”‚
â”‚ notes      â”‚   â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚           â”‚
                 â”‚           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚                 â”‚  â”‚
    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Packages     â”‚    â”‚ Users       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id           â”‚    â”‚ id          â”‚
    â”‚ name         â”‚    â”‚ name        â”‚
    â”‚ image        â”‚    â”‚ email       â”‚
    â”‚ description  â”‚    â”‚ ...         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ many-to-many through PackagesServices
        â”‚
    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Services             â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id                   â”‚
    â”‚ name                 â”‚
    â”‚ is_active            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Last Updated**: 2026-01-01
